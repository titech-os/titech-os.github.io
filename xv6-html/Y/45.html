<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>bp</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.5.1' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<pre>
<span class='curline'><a href='../S/22.html#L31'>bp</a>                 31 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L33'>bp</a>                 33 fs.c             bp = bread(dev, 1);</span>
<span class='curline'><a href='../S/22.html#L34'>bp</a>                 34 fs.c             memmove(sb, bp-&gt;data, sizeof(*sb));</span>
<span class='curline'><a href='../S/22.html#L35'>bp</a>                 35 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L42'>bp</a>                 42 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L44'>bp</a>                 44 fs.c             bp = bread(dev, bno);</span>
<span class='curline'><a href='../S/22.html#L45'>bp</a>                 45 fs.c             memset(bp-&gt;data, 0, BSIZE);</span>
<span class='curline'><a href='../S/22.html#L46'>bp</a>                 46 fs.c             log_write(bp);</span>
<span class='curline'><a href='../S/22.html#L47'>bp</a>                 47 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L57'>bp</a>                 57 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L59'>bp</a>                 59 fs.c             bp = 0;</span>
<span class='curline'><a href='../S/22.html#L61'>bp</a>                 61 fs.c               bp = bread(dev, BBLOCK(b, sb));</span>
<span class='curline'><a href='../S/22.html#L64'>bp</a>                 64 fs.c                 if((bp-&gt;data[bi/8] &amp; m) == 0){  // Is block free?</span>
<span class='curline'><a href='../S/22.html#L65'>bp</a>                 65 fs.c                   bp-&gt;data[bi/8] |= m;  // Mark block in use.</span>
<span class='curline'><a href='../S/22.html#L66'>bp</a>                 66 fs.c                   log_write(bp);</span>
<span class='curline'><a href='../S/22.html#L67'>bp</a>                 67 fs.c                   brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L72'>bp</a>                 72 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L81'>bp</a>                 81 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L85'>bp</a>                 85 fs.c             bp = bread(dev, BBLOCK(b, sb));</span>
<span class='curline'><a href='../S/22.html#L88'>bp</a>                 88 fs.c             if((bp-&gt;data[bi/8] &amp; m) == 0)</span>
<span class='curline'><a href='../S/22.html#L90'>bp</a>                 90 fs.c             bp-&gt;data[bi/8] &amp;= ~m;</span>
<span class='curline'><a href='../S/22.html#L91'>bp</a>                 91 fs.c             log_write(bp);</span>
<span class='curline'><a href='../S/22.html#L92'>bp</a>                 92 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L180'>bp</a>                180 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L184'>bp</a>                184 fs.c               bp = bread(dev, IBLOCK(inum, sb));</span>
<span class='curline'><a href='../S/22.html#L185'>bp</a>                185 fs.c               dip = (struct dinode*)bp-&gt;data + inum%IPB;</span>
<span class='curline'><a href='../S/22.html#L189'>bp</a>                189 fs.c                 log_write(bp);   // mark it allocated on the disk</span>
<span class='curline'><a href='../S/22.html#L190'>bp</a>                190 fs.c                 brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L193'>bp</a>                193 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L202'>bp</a>                202 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L205'>bp</a>                205 fs.c             bp = bread(ip-&gt;dev, IBLOCK(ip-&gt;inum, sb));</span>
<span class='curline'><a href='../S/22.html#L206'>bp</a>                206 fs.c             dip = (struct dinode*)bp-&gt;data + ip-&gt;inum%IPB;</span>
<span class='curline'><a href='../S/22.html#L213'>bp</a>                213 fs.c             log_write(bp);</span>
<span class='curline'><a href='../S/22.html#L214'>bp</a>                214 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L269'>bp</a>                269 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L282'>bp</a>                282 fs.c               bp = bread(ip-&gt;dev, IBLOCK(ip-&gt;inum, sb));</span>
<span class='curline'><a href='../S/22.html#L283'>bp</a>                283 fs.c               dip = (struct dinode*)bp-&gt;data + ip-&gt;inum%IPB;</span>
<span class='curline'><a href='../S/22.html#L290'>bp</a>                290 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L360'>bp</a>                360 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L373'>bp</a>                373 fs.c               bp = bread(ip-&gt;dev, addr);</span>
<span class='curline'><a href='../S/22.html#L374'>bp</a>                374 fs.c               a = (uint*)bp-&gt;data;</span>
<span class='curline'><a href='../S/22.html#L377'>bp</a>                377 fs.c                 log_write(bp);</span>
<span class='curline'><a href='../S/22.html#L379'>bp</a>                379 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L395'>bp</a>                395 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L406'>bp</a>                406 fs.c               bp = bread(ip-&gt;dev, ip-&gt;addrs[NDIRECT]);</span>
<span class='curline'><a href='../S/22.html#L407'>bp</a>                407 fs.c               a = (uint*)bp-&gt;data;</span>
<span class='curline'><a href='../S/22.html#L412'>bp</a>                412 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L438'>bp</a>                438 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L452'>bp</a>                452 fs.c               bp = bread(ip-&gt;dev, bmap(ip, off/BSIZE));</span>
<span class='curline'><a href='../S/22.html#L454'>bp</a>                454 fs.c               memmove(dst, bp-&gt;data + off%BSIZE, m);</span>
<span class='curline'><a href='../S/22.html#L455'>bp</a>                455 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/22.html#L466'>bp</a>                466 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/22.html#L480'>bp</a>                480 fs.c               bp = bread(ip-&gt;dev, bmap(ip, off/BSIZE));</span>
<span class='curline'><a href='../S/22.html#L482'>bp</a>                482 fs.c               memmove(bp-&gt;data + off%BSIZE, src, m);</span>
<span class='curline'><a href='../S/22.html#L483'>bp</a>                483 fs.c               log_write(bp);</span>
<span class='curline'><a href='../S/22.html#L484'>bp</a>                484 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/90.html#L27'>bp</a>                 27 umalloc.c        Header *bp, *p;</span>
<span class='curline'><a href='../S/90.html#L29'>bp</a>                 29 umalloc.c        bp = (Header*)ap - 1;</span>
<span class='curline'><a href='../S/90.html#L30'>bp</a>                 30 umalloc.c        for(p = freep; !(bp &gt; p &amp;&amp; bp &lt; p-&gt;s.ptr); p = p-&gt;s.ptr)</span>
<span class='curline'><a href='../S/90.html#L31'>bp</a>                 31 umalloc.c          if(p &gt;= p-&gt;s.ptr &amp;&amp; (bp &gt; p || bp &lt; p-&gt;s.ptr))</span>
<span class='curline'><a href='../S/90.html#L33'>bp</a>                 33 umalloc.c        if(bp + bp-&gt;s.size == p-&gt;s.ptr){</span>
<span class='curline'><a href='../S/90.html#L34'>bp</a>                 34 umalloc.c          bp-&gt;s.size += p-&gt;s.ptr-&gt;s.size;</span>
<span class='curline'><a href='../S/90.html#L35'>bp</a>                 35 umalloc.c          bp-&gt;s.ptr = p-&gt;s.ptr-&gt;s.ptr;</span>
<span class='curline'><a href='../S/90.html#L37'>bp</a>                 37 umalloc.c          bp-&gt;s.ptr = p-&gt;s.ptr;</span>
<span class='curline'><a href='../S/90.html#L38'>bp</a>                 38 umalloc.c        if(p + p-&gt;s.size == bp){</span>
<span class='curline'><a href='../S/90.html#L39'>bp</a>                 39 umalloc.c          p-&gt;s.size += bp-&gt;s.size;</span>
<span class='curline'><a href='../S/90.html#L40'>bp</a>                 40 umalloc.c          p-&gt;s.ptr = bp-&gt;s.ptr;</span>
<span class='curline'><a href='../S/90.html#L42'>bp</a>                 42 umalloc.c          p-&gt;s.ptr = bp;</span>
</pre>
</body>
</html>
