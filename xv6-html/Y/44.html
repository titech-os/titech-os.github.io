<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>bp</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.6.2' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<pre>
<span class='curline'><a href='../S/46.html#L34'>bp</a>                 34 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L36'>bp</a>                 36 fs.c             bp = bread(dev, 1);</span>
<span class='curline'><a href='../S/46.html#L37'>bp</a>                 37 fs.c             memmove(sb, bp-&gt;data, sizeof(*sb));</span>
<span class='curline'><a href='../S/46.html#L38'>bp</a>                 38 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L45'>bp</a>                 45 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L47'>bp</a>                 47 fs.c             bp = bread(dev, bno);</span>
<span class='curline'><a href='../S/46.html#L48'>bp</a>                 48 fs.c             memset(bp-&gt;data, 0, BSIZE);</span>
<span class='curline'><a href='../S/46.html#L49'>bp</a>                 49 fs.c             log_write(bp);</span>
<span class='curline'><a href='../S/46.html#L50'>bp</a>                 50 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L60'>bp</a>                 60 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L62'>bp</a>                 62 fs.c             bp = 0;</span>
<span class='curline'><a href='../S/46.html#L64'>bp</a>                 64 fs.c               bp = bread(dev, BBLOCK(b, sb));</span>
<span class='curline'><a href='../S/46.html#L67'>bp</a>                 67 fs.c                 if((bp-&gt;data[bi/8] &amp; m) == 0){  // Is block free?</span>
<span class='curline'><a href='../S/46.html#L68'>bp</a>                 68 fs.c                   bp-&gt;data[bi/8] |= m;  // Mark block in use.</span>
<span class='curline'><a href='../S/46.html#L69'>bp</a>                 69 fs.c                   log_write(bp);</span>
<span class='curline'><a href='../S/46.html#L70'>bp</a>                 70 fs.c                   brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L75'>bp</a>                 75 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L84'>bp</a>                 84 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L88'>bp</a>                 88 fs.c             bp = bread(dev, BBLOCK(b, sb));</span>
<span class='curline'><a href='../S/46.html#L91'>bp</a>                 91 fs.c             if((bp-&gt;data[bi/8] &amp; m) == 0)</span>
<span class='curline'><a href='../S/46.html#L93'>bp</a>                 93 fs.c             bp-&gt;data[bi/8] &amp;= ~m;</span>
<span class='curline'><a href='../S/46.html#L94'>bp</a>                 94 fs.c             log_write(bp);</span>
<span class='curline'><a href='../S/46.html#L95'>bp</a>                 95 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L199'>bp</a>                199 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L203'>bp</a>                203 fs.c               bp = bread(dev, IBLOCK(inum, sb));</span>
<span class='curline'><a href='../S/46.html#L204'>bp</a>                204 fs.c               dip = (struct dinode*)bp-&gt;data + inum%IPB;</span>
<span class='curline'><a href='../S/46.html#L208'>bp</a>                208 fs.c                 log_write(bp);   // mark it allocated on the disk</span>
<span class='curline'><a href='../S/46.html#L209'>bp</a>                209 fs.c                 brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L212'>bp</a>                212 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L224'>bp</a>                224 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L227'>bp</a>                227 fs.c             bp = bread(ip-&gt;dev, IBLOCK(ip-&gt;inum, sb));</span>
<span class='curline'><a href='../S/46.html#L228'>bp</a>                228 fs.c             dip = (struct dinode*)bp-&gt;data + ip-&gt;inum%IPB;</span>
<span class='curline'><a href='../S/46.html#L235'>bp</a>                235 fs.c             log_write(bp);</span>
<span class='curline'><a href='../S/46.html#L236'>bp</a>                236 fs.c             brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L291'>bp</a>                291 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L300'>bp</a>                300 fs.c               bp = bread(ip-&gt;dev, IBLOCK(ip-&gt;inum, sb));</span>
<span class='curline'><a href='../S/46.html#L301'>bp</a>                301 fs.c               dip = (struct dinode*)bp-&gt;data + ip-&gt;inum%IPB;</span>
<span class='curline'><a href='../S/46.html#L308'>bp</a>                308 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L377'>bp</a>                377 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L390'>bp</a>                390 fs.c               bp = bread(ip-&gt;dev, addr);</span>
<span class='curline'><a href='../S/46.html#L391'>bp</a>                391 fs.c               a = (uint*)bp-&gt;data;</span>
<span class='curline'><a href='../S/46.html#L394'>bp</a>                394 fs.c                 log_write(bp);</span>
<span class='curline'><a href='../S/46.html#L396'>bp</a>                396 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L412'>bp</a>                412 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L423'>bp</a>                423 fs.c               bp = bread(ip-&gt;dev, ip-&gt;addrs[NDIRECT]);</span>
<span class='curline'><a href='../S/46.html#L424'>bp</a>                424 fs.c               a = (uint*)bp-&gt;data;</span>
<span class='curline'><a href='../S/46.html#L429'>bp</a>                429 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L457'>bp</a>                457 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L471'>bp</a>                471 fs.c               bp = bread(ip-&gt;dev, bmap(ip, off/BSIZE));</span>
<span class='curline'><a href='../S/46.html#L473'>bp</a>                473 fs.c               memmove(dst, bp-&gt;data + off%BSIZE, m);</span>
<span class='curline'><a href='../S/46.html#L474'>bp</a>                474 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/46.html#L486'>bp</a>                486 fs.c             struct buf *bp;</span>
<span class='curline'><a href='../S/46.html#L500'>bp</a>                500 fs.c               bp = bread(ip-&gt;dev, bmap(ip, off/BSIZE));</span>
<span class='curline'><a href='../S/46.html#L502'>bp</a>                502 fs.c               memmove(bp-&gt;data + off%BSIZE, src, m);</span>
<span class='curline'><a href='../S/46.html#L503'>bp</a>                503 fs.c               log_write(bp);</span>
<span class='curline'><a href='../S/46.html#L504'>bp</a>                504 fs.c               brelse(bp);</span>
<span class='curline'><a href='../S/45.html#L27'>bp</a>                 27 umalloc.c        Header *bp, *p;</span>
<span class='curline'><a href='../S/45.html#L29'>bp</a>                 29 umalloc.c        bp = (Header*)ap - 1;</span>
<span class='curline'><a href='../S/45.html#L30'>bp</a>                 30 umalloc.c        for(p = freep; !(bp &gt; p &amp;&amp; bp &lt; p-&gt;s.ptr); p = p-&gt;s.ptr)</span>
<span class='curline'><a href='../S/45.html#L31'>bp</a>                 31 umalloc.c          if(p &gt;= p-&gt;s.ptr &amp;&amp; (bp &gt; p || bp &lt; p-&gt;s.ptr))</span>
<span class='curline'><a href='../S/45.html#L33'>bp</a>                 33 umalloc.c        if(bp + bp-&gt;s.size == p-&gt;s.ptr){</span>
<span class='curline'><a href='../S/45.html#L34'>bp</a>                 34 umalloc.c          bp-&gt;s.size += p-&gt;s.ptr-&gt;s.size;</span>
<span class='curline'><a href='../S/45.html#L35'>bp</a>                 35 umalloc.c          bp-&gt;s.ptr = p-&gt;s.ptr-&gt;s.ptr;</span>
<span class='curline'><a href='../S/45.html#L37'>bp</a>                 37 umalloc.c          bp-&gt;s.ptr = p-&gt;s.ptr;</span>
<span class='curline'><a href='../S/45.html#L38'>bp</a>                 38 umalloc.c        if(p + p-&gt;s.size == bp){</span>
<span class='curline'><a href='../S/45.html#L39'>bp</a>                 39 umalloc.c          p-&gt;s.size += bp-&gt;s.size;</span>
<span class='curline'><a href='../S/45.html#L40'>bp</a>                 40 umalloc.c          p-&gt;s.ptr = bp-&gt;s.ptr;</span>
<span class='curline'><a href='../S/45.html#L42'>bp</a>                 42 umalloc.c          p-&gt;s.ptr = bp;</span>
</pre>
</body>
</html>
